<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>

<head>
    <title>Test Page - Amazon Web Services (AWS)</title>

	<link href="http://www.mattsnider.com//assets/css/library.css" type="text/css" rel="stylesheet"/>
	<link href="/assets/css/test.css" type="text/css" rel="stylesheet"/>

	<style type="text/css">
    </style>
</head>

<body id="project"><div id="doc">

	<h1>Test Page - Amazon Web Services (AWS)</h1>

	<p>The AWS Utility allows you to make queries against the Amazon Web Services API. For the simplest usage,
	enter any UPC code and click submit. You will see the XML appear in the text field below and some basic
	information about the item.</p>

	<p>If you would like to see that result parsed as JSON, then change the responseType. Changing the ResponseGroup
	alters the content that is returned by Amazon. Almost every ResponseGroup is support by the XML system,
	but only about 1/3 are supported by the JSON parser (mostly because of parser limitations). The Operation is
	the what you would like AWS to do, if you use ItemLookup or SimilarityLookup then the UPC field will expect
	a UPC code. If you use ItemSearch, then the UPC field is actually a keyword search.</p>

	<div id="content">
		<div id="form-aws"><form action="#" method="post" title="the form 1 is submitted"><fieldset>
			<legend>AWS UPC Form</legend>
			<dl>
				<dt><label for="form-aws-upc">UPC:</label></dt>
				<dd><input id="form-aws-upc" type="text" tabindex="1" name="upc" class="txt"/></dd>
				<dt class="displayNone"><label for="form-aws-keywords">Keywords:</label></dt>
				<dd class="displayNone"><input id="form-aws-keywords" type="text" tabindex="1" name="keywords" class="txt"/></dd>
				<dt><label for="form-aws-responseGroup">ResponseGroup:</label></dt>
				<dd><select id="form-aws-responseGroup" tabindex="2" name="responseGroup">
					<option value="Request">Request</option>
					<option value="ItemIds">ItemIds</option>
					<option value="Small" selected="selected">Small</option>
					<option value="Medium">Medium</option>
					<option value="Large">Large</option>
					<option value="Offers">Offers</option>
					<option value="OfferFull">OfferFull</option>
					<option value="OfferSummary">OfferSummary</option>
					<option value="OfferListings">OfferListings</option>
					<option value="PromotionSummary">PromotionSummary</option>
					<option value="PromotionDetails">PromotionDetails</option>
					<option value="Variations">Variations</option>
					<option value="VariationImages">VariationImages</option>
					<option value="VariationMinimum">VariationMinimum</option>
					<option value="VariationSummary">VariationSummary</option>
					<option value="TagsSummary">TagsSummary</option>
					<option value="Tags">Tags</option>
					<option value="VariationMatrix">VariationMatrix</option>
					<option value="VariationOffers">VariationOffers</option>
					<option value="ItemAttributes">ItemAttributes</option>
					<option value="MerchantItemAttributes">MerchantItemAttributes</option>
					<option value="Tracks">Tracks</option>
					<option value="Accessories">Accessories</option>
					<option value="EditorialReview">EditorialReview</option>
					<option value="SalesRank">SalesRank</option>
					<option value="BrowseNodes">BrowseNodes</option>
					<option value="Images">Images</option>
					<option value="Similarities">Similarities</option>
					<option value="Subjects">Subjects</option>
					<option value="Reviews">Reviews</option>
					<option value="ListmaniaLists">ListmaniaLists</option>
					<option value="SearchInside">SearchInside</option>
					<option value="PromotionalTag">PromotionalTag</option>
					<option value="AlternateVersions">AlternateVersions</option>
					<option value="Collections">Collections</option>
					<option value="ShippingCharges">ShippingCharges</option>
					<option value="RelatedItems">RelatedItems</option>
				</select></dd>
				<dt><label for="form-aws-responseType">ResponseType</label></dt>
				<dd><select id="form-aws-responseType" tabindex="3">
					<option value="json">json</option>
					<option value="xml" selected="selected">xml</option>
				</select></dd>
				<dt><label for="form-aws-operation">Operation</label></dt>
				<dd><select id="form-aws-operation" tabindex="4">
					<option value="BrowseNodeLookup">BrowseNodeLookup</option>
					<option value="CartCreate">CartCreate</option>
					<option value="CustomerContentLookup">CustomerContentLookup</option>
					<option value="ItemLookup" selected="selected">ItemLookup</option>
					<option value="ItemSearch">ItemSearch</option>
					<option value="ListLookup">ListLookup</option>
					<option value="SimilarityLookup">SimilarityLookup</option>
					<option value="TagLookup">TagLookup</option>
					<option value="TransactionLookup">TransactionLookup</option>
				</select></dd>
				<dt><label for="form-aws-other">Other Parameters</label></dt>
				<dd>
					<input id="form-aws-other" type="text" tabindex="5" name="other" class="txt"/><br/>
					<small>If you know what you are doing and have additional parameters (&key=value...).</small>
				</dd>
				<dd class="buttons">
					<input id="form-aws-submit" name="submit" tabindex="6" type="submit" value="submit"/>
				</dd>
			</dl>
		</fieldset></form></div>

		<div id="aws-results">
			<p><label>Title: </label><span id="aws-results-title"></span></p>
			<p><label>ASIN: </label><span id="aws-results-asin"></span></p>
			<p><label>Amazon URL: </label><span id="aws-results-url"></span></p>
			<p><label>AWS URL: </label><span id="aws-results-awsurl"></span></p>
		</div>

		<label for="form-aws-results">AWS Result</label>
		<textarea id="form-aws-results" rows="10" cols="60"></textarea>
	</div>

	<script src="http://yui.yahooapis.com/3.0.0/build/yui/yui-min.js" type="text/javascript"></script>
	<script type="text/javascript">YUI({
		filter:'raw',
		combine: true,
		timeout: 10000,
		modules: {
			'gallery-aws': {
//				fullpath: 'http://yui.yahooapis.com/gallery-2009.11.02-20/build/gallery-form/gallery-form.js',
				fullpath: 'http://core.localhost/assets/js/yahoo-3-ext/aws.js?r7',
				requires: ['io-base', 'io-xdr', 'json-parse', 'collection', 'dataschema', 'datatype-xml'],
				optional: [],
				supersedes: []
			},
			'gallery-aws-json': {
				fullpath: 'http://core.localhost/assets/js/yahoo-3-ext/aws-json.js?r7',
				requires: ['oop', 'datatype-json', 'gallery-aws'],
				optional: [],
				supersedes: []
			}
		}
	}).use('node', 'json-stringify', 'gallery-aws', 'gallery-aws-json', function(Y) {
		var _domResults = Y.one('#form-aws-results'),
			_domResponseGroup = Y.one('#form-aws-responseGroup'),
			_domResponseType = Y.one('#form-aws-responseType'),
			_domOperation = Y.one('#form-aws-operation'),
			_domOther = Y.one('#form-aws-other'),
			_domResultTitle = Y.one('#aws-results-title'),
			_domResultAsin = Y.one('#aws-results-asin'),
			_domResultUrl = Y.one('#aws-results-url'),
			_domResultAWSUrl = Y.one('#aws-results-awsurl'),
			_domKeywords = Y.one('#form-aws-keywords'),
			_domUpc = Y.one('#form-aws-upc');

		function _getSelectedValue(node) {
			var selectedIndex = node.get('selectedIndex'),
				option;

			node.get('options').each(function(node) {
					if (node.get('index') === selectedIndex) {
						option = node;
					}
				});

			return option.get('value');
		}

		// hanlde the form submission
		Y.one('#form-aws form').on('submit', function(e) {
			e.halt();
			var aws = new Y.Aws({
				ioSWFURL: '/assets/files/io.swf',
				responseGroup: _getSelectedValue(_domResponseGroup),
				operation: _getSelectedValue(_domOperation),
				awsSignedUrl: '/getAWSSignedUrl.php?' + _domOther.get('value')
			}), data, value = _getSelectedValue(_domOperation);

			switch (value) {
				case 'ItemLookup':
				case 'SimilarityLookup':
					data = {ItemId:_domUpc.get('value'), IdType: 'ASIN'};
				break;
				case 'ItemSearch':
					data = {Keywords:_domKeywords.get('value')};
				break;
				default:
					alert('Operation "' + value + '" not yet supported');
					return;
			}
			
			aws.getJSON(data, function(id, o) {
				var isXML = 'xml' == _getSelectedValue(_domResponseType),
					json = o.responseJSON,
					result = json.results[0];

				_domResults.set('value', isXML ? Y.DataType.XML.format(o.responseXML) : Y.JSON.stringify(o.responseJSON, null, 4));
				_domResultAWSUrl.set('href', o.awsURL);
				_domResultAWSUrl.set('innerHTML', o.awsURL ? '<a href="' + o.awsURL + '">AWS URL</a>' : '');

				_domResultUrl.set('href', result ? result.detailPageURL : '');
				_domResultUrl.set('innerHTML', result && result.detailPageURL ? '<a href="' + result.detailPageURL + '">Amazon URL</a>' : '');
				_domResultTitle.set('innerHTML', result ? result.title : '');
				_domResultAsin.set('innerHTML', result ? result.asin : '');
			});
		});

		// update the form to handle operation
		_domOperation.on('change', function() {
			var value = _getSelectedValue(_domOperation);
			switch (value) {
				case 'ItemSearch':
					_domKeywords.get('parentNode').removeClass('displayNone');
					_domKeywords.get('parentNode').previous().removeClass('displayNone');
					_domUpc.get('parentNode').addClass('displayNone');
					_domUpc.get('parentNode').previous().addClass('displayNone');
					break;
				case 'ItemLookup':
				case 'SimilarityLookup':
					_domKeywords.get('parentNode').addClass('displayNone');
					_domKeywords.get('parentNode').previous().addClass('displayNone');
					_domUpc.get('parentNode').removeClass('displayNone');
					_domUpc.get('parentNode').previous().removeClass('displayNone');
					break;
				default: alert('Operation "' + value + '" not yet supported');
			}
		});
	});</script>
</div></body>
</html>